InitPeripheral:
	MOV R0, 0x40023830 ;Init RCC GPIOD
	PUSH R0
	;hh
	MOV R10, 0x00000019
	OUT R10
	MOV R0, 0x40020C00 ;Init GPIOD
	PUSH R0
	MOV R10, 0x55550000
	OUT R10
	MOV R0, 0x40021000 ;Init GPIOE
	PUSH R0
	MOV R10, 0x00000055
	OUT R10
	MOV R0, 0x40020000 ;Init GPIOA
	PUSH R0
	MOV R10, 0x00000005
	OUT R10
	CALL LCDInit
	MOV R20, 0xC1
	CALL WriteCommand
	MOV R20, 0x41
	CALL WriteData
	MOV R20, 0x52
	CALL WriteData
	MOV R20, 0x4D
	CALL WriteData
	MOV R20, 0x20
	CALL WriteData
	MOV R20, 0x54
	CALL WriteData
	MOV R20, 0x72
	CALL WriteData
	MOV R20, 0x61
	CALL WriteData
	MOV R20, 0x6E
	CALL WriteData
	MOV R20, 0x73
	CALL WriteData
	MOV R20, 0x6C
	CALL WriteData
	MOV R20, 0x61
	CALL WriteData
	MOV R20, 0x74
	CALL WriteData
	MOV R20, 0x6F
	CALL WriteData
	MOV R20, 0x72
	CALL WriteData
Main:
	MOV R0, 0x40020C14 ;Led 1
	PUSH R0
	MOV R10, 0x00001000
	OUT R10
	CALL Delay5000
	MOV R0, 0x40020C14 ;Led 1,2
	PUSH R0
	MOV R10, 0x00003000
	OUT R10
	CALL Delay5000
	MOV R0, 0x40020C14 ;Led 1,2,3
	PUSH R0
	MOV R10, 0x00007000
	OUT R10
	CALL Delay5000
	MOV R0, 0x40020C14 ;Led 1,2,3,4
	PUSH R0
	MOV R10, 0x0000F000
	OUT R10
	CALL Delay5000
	MOV R0, 0x40020C14 ;Led 2,3,4
	PUSH R0
	MOV R10, 0x0000E000
	OUT R10
	CALL Delay5000
	MOV R0, 0x40020C14 ;Led 3,4
	PUSH R0
	MOV R10, 0x0000C000
	OUT R10
	CALL Delay5000
	MOV R0, 0x40020C14 ;Led 4
	PUSH R0
	MOV R10, 0x00008000
	OUT R10
	CALL Delay5000
	JP Main
LCDInit:
	CALL Delay5000
	CALL Delay5000
	CALL Delay5000
	MOV R0, 0x40020014 ;RS off
	PUSH R0
	MOV R10, 0x00000000
	OUT R10
	MOV R0, 0x40020014 ;E on
	PUSH R0
	MOV R10, 0x00000002
	OUT R10
	MOV R0, 0x40021014 ;High 4 bit out
	PUSH R0
	MOV R2, 0x02
	OUT R2
	MOV R0, 0x40020014 ;E off
	PUSH R0
	MOV R10, 0x00000000
	OUT R10
	CALL Delay5000
	CALL Delay5000
	CALL Delay5000
	MOV R20, 0x2C
	CALL WriteCommand
	MOV R20, 0x0C
	CALL WriteCommand
	MOV R20, 0x06
	CALL WriteCommand
	RET
WriteData:
	MOV R0, 0x40020014 ;RS on
	PUSH R0
	MOV R10, 0x00000001
	OUT R10
	MOV R0, 0x40021014 ;High 4 bit out
	PUSH R0
	MOV R2, R20
	DIV R2, 16
	OUT R2
	MOV R0, 0x40020014 ;E on
	PUSH R0
	MOV R10, 0x00000003
	OUT R10
	CALL Delay500
	MOV R0, 0x40020014 ;E off
	PUSH R0
	MOV R10, 0x00000001
	OUT R10
	MOV R0, 0x40021014 ;Low 4 bit out
	PUSH R0
	MOV R2, R20
	OUT R2
	MOV R0, 0x40020014 ;E on
	PUSH R0
	MOV R10, 0x00000003
	OUT R10
	CALL Delay500
	MOV R0, 0x40020014 ;E off
	PUSH R0
	MOV R10, 0x00000001
	OUT R10	
	MOV R0, 0x40020014 ;RS off
	PUSH R0
	MOV R10, 0x00000000
	OUT R10
	CALL Delay5000
	RET
WriteCommand:
	MOV R0, 0x40020014 ;RS off
	PUSH R0
	MOV R10, 0x00000000
	OUT R10
	MOV R0, 0x40021014 ;High 4 bit out
	PUSH R0
	MOV R2, R20
	DIV R2, 16
	OUT R2
	MOV R0, 0x40020014 ;E on
	PUSH R0
	MOV R10, 0x00000002
	OUT R10
	CALL Delay500
	MOV R0, 0x40020014 ;E off
	PUSH R0
	MOV R10, 0x00000000
	OUT R10
	MOV R0, 0x40021014 ;Low 4 bit out
	PUSH R0
	MOV R2, R20
	OUT R2
	MOV R0, 0x40020014 ;E on
	PUSH R0
	MOV R10, 0x00000002
	OUT R10
	CALL Delay500
	MOV R0, 0x40020014 ;E off
	PUSH R0
	MOV R10, 0x00000000
	OUT R10
	CALL Delay5000
	RET
Delay5000:
	MOV R30, 50000
Gk2:
	SUB R30, 1
	CMP R30, 0
	JA Gk2
	RET
Delay500:
	MOV R30, 5000
Gk:
	SUB R30, 1
	CMP R30, 0
	JA Gk
	RET
	END
